<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Test de Inform√°tica</title>
<!-- Firebase SDK v9 (compatibilidad) -->
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap');
  html, body {
    margin: 0; padding: 0;
    font-family: 'Comic Neue', cursive, sans-serif;
    background: linear-gradient(135deg, #fceabb, #f8b500);
    color: #222;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
  }
  body { padding: 10px; }

  #app, #start-screen, #test-screen {
    background: white;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    width: 90vw;
    max-width: 900px;
    max-height: 600px;
    overflow: hidden;
    padding: 25px 35px 50px 35px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    position: relative;
  }

  #test-screen {
    display: none;
    flex-grow: 1;
  }

  h1 {
    text-align: center;
    color: #e8590c;
    margin-bottom: 20px;
    font-size: 2rem;
    text-shadow: 2px 2px #e2a127;
  }

  #start-screen h1 {
    margin-top: auto;
    margin-bottom: 20px;
  }

  #name-input {
    font-size: 1.4rem;
    padding: 12px 14px;
    border-radius: 14px;
    border: 3px solid #f8b500;
    width: 100%;
    max-width: 400px;
    margin: 0 auto 40px;
    box-sizing: border-box;
    font-family: 'Comic Neue', cursive, sans-serif;
    font-weight: 700;
    text-align: center;
    transition: border-color 0.3s ease;
  }
  #name-input:focus {
    border-color: #e8590c;
    outline: none;
  }

  #start-btn {
    background: #e8590c;
    border: none;
    color: white;
    font-weight: 700;
    font-size: 2.4rem;
    padding: 30px 0;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 8px 20px #d35400cc;
    user-select: none;
    transition: background-color 0.3s ease;
    width: 100%;
    max-width: 400px;
    margin: 0 auto 50px;
    display: block;
  }
  #start-btn:hover {
    background: #cc4e0a;
  }

  #question-container {
    flex-grow: 1;
    background: #fffcf7;
    border: 3px solid #f8b500;
    border-radius: 16px;
    box-shadow: 0 6px 12px #f9d77e;
    padding: 20px 30px;
    font-weight: 700;
    font-size: 1.3rem;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
  }

  #question-text {
    margin-bottom: 20px;
  }

  .options {
    display: flex;
    flex-direction: column;
    gap: 14px;
    margin-left: 6px;
  }

  label.option-label {
    background: #fff2cc;
    border-radius: 14px;
    padding: 12px 18px;
    cursor: pointer;
    user-select: none;
    box-shadow: 1px 1px 6px #f7c948cc;
    transition: background-color 0.3s ease;
    display: flex;
    align-items: center;
    font-size: 1.15rem;
  }

  label.option-label:hover {
    background: #ffea85;
  }

  input[type="radio"] {
    margin-right: 14px;
    cursor: pointer;
  }

  #navigation {
    display: flex;
    justify-content: space-between;
    margin-top: 25px;
    gap: 10px;
  }

  button {
    background: #e8590c;
    border: none;
    color: white;
    font-weight: 700;
    font-size: 1.15rem;
    padding: 14px 30px;
    border-radius: 25px;
    cursor: pointer;
    box-shadow: 0 6px 14px #d35400cc;
    user-select: none;
    transition: background-color 0.3s ease;
    min-width: 120px;
  }

  button:hover:not(:disabled) {
    background: #cc4e0a;
  }

  button:disabled {
    background: #999;
    cursor: default;
  }

  #result {
    margin-top: 28px;
    font-size: 1.4rem;
    font-weight: 700;
    text-align: center;
    min-height: 3rem;
  }

  #result.success {
    color: #2c662d;
  }

  #result.warning {
    color: #b58105;
  }

  #result.error {
    color: #e63946;
  }

  @media (max-width: 400px) {
    #app, #start-screen, #test-screen {
      width: 95vw;
      padding: 20px 15px 40px 15px;
    }
    #question-container {
      padding: 15px 20px;
      font-size: 1.1rem;
    }
    label.option-label {
      font-size: 1rem;
      padding: 10px 14px;
    }
    button, #start-btn {
      font-size: 1.3rem;
      padding: 16px 20px;
      min-width: auto;
      border-radius: 20px;
    }
    #name-input {
      font-size: 1.2rem;
      padding: 10px 12px;
      max-width: 100%;
      margin-bottom: 30px;
    }
  }
</style>
</head>
<body>
<div id="start-screen" role="main" aria-label="Pantalla de inicio Test de Inform√°tica">
  <h1>Bienvenido al Test de Inform√°tica</h1>
  <input type="text" id="name-input" placeholder="Escribe tu nombre" aria-label="Nombre del participante" />
  <button id="start-btn" aria-label="Comenzar test">Comenzar Test</button>
</div>

<div id="test-screen" role="main" aria-label="Formulario Test de Inform√°tica" tabindex="-1" style="display:none;">
  <h1>Test de Inform√°tica</h1>

  <div id="question-container" aria-live="polite" aria-atomic="true">
    <div id="greeting" style="text-align:center; font-weight:700; font-size:1.3rem; margin-bottom:12px;"></div>
    <div id="question-text"></div>
    <form id="options-form" aria-describedby="instruction-text"></form>
  </div>

  <div id="instruction-text" style="position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;">
    Usa las flechas anterior y siguiente para navegar. Al finalizar pulsa Validar para comprobar tus respuestas.
  </div>

  <div id="navigation">
    <button id="prev-btn" type="button" aria-label="Pregunta anterior" disabled>Anterior</button>
    <button id="next-btn" type="button" aria-label="Siguiente pregunta">Siguiente</button>
  </div>

  <button id="validate-btn" type="button" style="margin-top: 25px; display:none;">Validar</button>
  <button id="reset-btn" type="button" style="margin-top: 10px; display:none;">Repetir Test</button>

  <div id="result" role="status"></div>
</div>

<!-- Div del ranking -->
<div id="ranking-container" style="display: none; margin-top: 30px; background: #fffcf7; border: 3px solid #f8b500; border-radius: 16px; padding: 20px;">
  <h2 style="text-align: center; color: #e8590c; margin-bottom: 15px;">üèÜ Top 10 Puntuaciones üèÜ</h2>
  <ol id="ranking-list" style="padding-left: 20px; font-size: 1.2rem;"></ol>
</div>

<script>
// Configuraci√≥n de Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDC1wCcBLtqXNLRGfFQ1eOu_IsNjZ1jNRk",
  authDomain: "test-7b9a3.firebaseapp.com",
  databaseURL: "https://test-7b9a3-default-rtdb.firebaseio.com", // A√±ad√≠ la URL de la Realtime Database
  projectId: "test-7b9a3",
  storageBucket: "test-7b9a3.appspot.com",
  messagingSenderId: "512565028384",
  appId: "1:512565028384:web:679c68e069fe4b0a6ebe45",
  measurementId: "G-VG17V2SRZN"
};

// Inicializa Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

(() => {
    const questions = [
    {
      question: "¬øQu√© es un ordenador?",
      options: [
        "Una m√°quina para cocinar",
        "Un dispositivo para procesar informaci√≥n",
        "Un instrumento musical"
      ],
      correct: 1
    },
    {
      question: "¬øQui√©n es el mejor profe de inform√°tica?",
      options: [
        "Hugo",
        "Raul",
        "Victor",
        "Marco"
      ],
      correct: [0, 1, 2, 3]
    },
    {
      question: "¬øQu√© es un mouse?",
      options: [
        "Un rat√≥n para ordenador",
        "Una tecla del teclado",
        "Un software"
      ],
      correct: 0
    },
    {
      question: "¬øQu√© componente del ordenador muestra im√°genes?",
      options: [
        "El teclado",
        "El monitor",
        "El procesador"
      ],
      correct: 1
    },
    {
      question: "¬øQu√© es un sistema operativo?",
      options: [
        "Un programa que administra el ordenador",
        "Un tipo de ordenador",
        "Una impresora"
      ],
      correct: 0
    },
    {
      question: "¬øPara qu√© sirve un navegador web?",
      options: [
        "Para navegar por Internet",
        "Para hacer llamadas",
        "Para imprimir documentos"
      ],
      correct: 0
    },
    {
      question: "¬øQu√© es un archivo?",
      options: [
        "Una carpeta",
        "Una unidad de almacenamiento",
        "Un documento o conjunto de datos guardados"
      ],
      correct: 2
    },
    {
      question: "¬øC√≥mo debemos estructurar un informe formal?",
      options: [
        "Portada, √≠ndice y contenido",
        "√çndice, contenido y conclusi√≥n",
        "Contenido, conclusi√≥n y bibliograf√≠a",
      ],
      correct: 0
    },
    {
        question: "¬øQu√© es un teclado?",
      options: [
        "Una pantalla",
        "Un dispositivo para introducir datos",
        "Un altavoz"
      ],
      correct: 1
    },
    {
      question: "¬øQu√© funci√≥n tiene el bot√≥n derecho del mouse?",
      options: [
        "Abrir un men√∫ contextual",
        "Seleccionar texto",
        "Cerrar el programa"
      ],
      correct: 0
    },
    {
      question: "¬øQu√© tipo de archivo suele tener la extensi√≥n .jpg?",
      options: [
        "Una imagen",
        "Un documento de texto",
        "Un video"
      ],
      correct: 0
    },
    {
        question: "¬øQue es internet?",
      options: [
        "Un juego",
        "Una red mundial de ordenadores",
        "Un programa"
      ],
      correct: 1
    },
    {
      question: "¬øQu√© tecla usas para borrar texto a la derecha del cursor?",
      options: [
        "Backspace",
        "Enter",
        "Supr (Delete)"
      ],
      correct: 2
    },
    {
      question: "¬ø¬¥Qu√© bot√≥n se usa para pegar un texto?",
      options: [
        "Ctrl + B",
        "Ctrl + V",
        "Crtl + A"
      ],
      correct: 1
    },
    {
        question: "¬øPara qu√© sirve el 'WhatsApp'?",
      options: [
        "Para enviar mensajes y llamadas",
        "Para navegar en internet",
        "Para editar fotos"
      ],
      correct: 0
    },
    {
      question: "¬øQu√© es un 'email'?",
      options: [
        "Un correo electr√≥nico",
        "Un programa de dibujo",
        "Un tipo de ordenador"
      ],
      correct: 0
    },
    {
      question: "¬øQu√© es un 'software'?",
      options: [
        "El hardware del ordenador",
        "Un programa o conjunto de instrucciones",
        "Una parte f√≠sica"
      ],
      correct: 1
    },
    {
        question: "¬øQu√© bot√≥n se usa para copiar texto?",
      options: [
        "Ctrl + C",
        "Ctrl + V",
        "Ctrl + P"
      ],
      correct: 0
    },
    {
      question: "¬øQu√© almacenan las 'cookies' en el ordenador?",
      options: [
        "Datos de navegaci√≥n",
        "Fotos",
        "M√∫sica"
      ],
      correct: 0
    },
    {
      question: "¬øQu√© hace el bot√≥n 'Enter'?",
      options: [
        "Cambia l√≠nea o ejecuta comandos",
        "Borra texto",
        "Abre un archivo"
      ],
      correct: 0
    }
  ];



  // Elementos del DOM
  const startScreen = document.getElementById('start-screen');
  const testScreen = document.getElementById('test-screen');
  const startBtn = document.getElementById('start-btn');
  const nameInput = document.getElementById('name-input');
  const greetingDiv = document.getElementById('greeting');
  const questionText = document.getElementById('question-text');
  const optionsForm = document.getElementById('options-form');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  const validateBtn = document.getElementById('validate-btn');
  const resetBtn = document.getElementById('reset-btn');
  const resultDiv = document.getElementById('result');

  let currentQuestionIndex = 0;
  const userAnswers = new Array(questions.length).fill(null);

  function renderQuestion(index) {
    const q = questions[index];
    questionText.textContent = `${index + 1}. ${q.question}`;
    optionsForm.innerHTML = '';

    q.options.forEach((opt, i) => {
      const inputId = `q${index}o${i}`;
      const isChecked = (userAnswers[index] === i);
      optionsForm.insertAdjacentHTML('beforeend',
        `<label class="option-label" for="${inputId}">
          <input type="radio" name="option" id="${inputId}" value="${i}" ${isChecked ? 'checked' : ''}>
          ${opt}
        </label>`
      );
    });

    prevBtn.disabled = index === 0;
    nextBtn.style.display = index === questions.length -1 ? 'none' : 'inline-block';
    validateBtn.style.display = index === questions.length -1 ? 'inline-block' : 'none';
    resultDiv.textContent = '';
    resultDiv.className = "";
  }

  function saveAnswer() {
    const selected = optionsForm.querySelector('input[name="option"]:checked');
    if (selected) {
      userAnswers[currentQuestionIndex] = parseInt(selected.value);
    }
  }

  function scrollToQuestion() {
    testScreen.scrollTo({top: 0, behavior: 'smooth'});
  }

  // Event listeners
  startBtn.addEventListener('click', () => {
    const name = nameInput.value.trim();
    if(name === ""){
      alert("Por favor, escribe tu nombre para comenzar el test.");
      nameInput.focus();
      return;
    }
    startScreen.style.display = 'none';
    testScreen.style.display = 'flex';
    greetingDiv.textContent = `Hola, ${name}! ¬°Buena suerte!`;
    renderQuestion(currentQuestionIndex);
    scrollToQuestion();
  });

  prevBtn.addEventListener('click', () => {
    saveAnswer();
    if (currentQuestionIndex > 0) {
      currentQuestionIndex--;
      renderQuestion(currentQuestionIndex);
      scrollToQuestion();
    }
  });

  nextBtn.addEventListener('click', () => {
    saveAnswer();
    if (currentQuestionIndex < questions.length - 1) {
      currentQuestionIndex++;
      renderQuestion(currentQuestionIndex);
      scrollToQuestion();
    }
  });

  validateBtn.addEventListener('click', () => {
    saveAnswer();

    const unansweredQuestions = [];
    for(let i=0; i<questions.length; i++){
      if (userAnswers[i] === null) unansweredQuestions.push(i+1);
    }
    if(unansweredQuestions.length > 0){
      alert(`Por favor responde la pregunta ${unansweredQuestions[0]} antes de validar.`);
      currentQuestionIndex = unansweredQuestions[0] - 1;
      renderQuestion(currentQuestionIndex);
      scrollToQuestion();
      return;
    }

    let correctCount = 0;
    for(let i=0; i<questions.length; i++){
      if(userAnswers[i] === questions[i].correct){
        correctCount++;
      }
    }

    const score = (correctCount / questions.length) * 10;
    const scoreRounded = Math.round(score * 10) /10;

    // Guardar la puntuaci√≥n
    const nombre = nameInput.value.trim();
    guardarPuntuacion(nombre, scoreRounded);

    if(scoreRounded === 5){
      resultDiv.className = "warning";
      resultDiv.textContent = `Justito, pero aprobaste. Nota: ${scoreRounded} / 10.`;
    } else if(scoreRounded > 5 && scoreRounded <=7){
      resultDiv.className = "success";
      resultDiv.textContent = `Muy bien, aprobaste. Nota: ${scoreRounded} / 10.`;
    } else if(scoreRounded > 7 && scoreRounded <=10){
      resultDiv.className = "success";
      resultDiv.textContent = `¬°Enhorabuena! Eres un crack. Nota: ${scoreRounded} / 10.`;
    } else {
      resultDiv.className = "error";
      resultDiv.textContent = `Suspendiste. Nota: ${scoreRounded} / 10. ¬°Int√©ntalo otra vez!`;
    }

    validateBtn.style.display = 'none';
    prevBtn.style.display = 'none';
    nextBtn.style.display = 'none';
    resetBtn.style.display = 'inline-block';
  });

  resetBtn.addEventListener('click', () => {
    userAnswers.fill(null);
    currentQuestionIndex = 0;
    renderQuestion(currentQuestionIndex);
    validateBtn.style.display = 'inline-block';
    prevBtn.style.display = 'inline-block';
    nextBtn.style.display = 'inline-block';
    resetBtn.style.display = 'none';
    resultDiv.textContent = '';
    resultDiv.className = "";
    scrollToQuestion();
  });

  // Funciones de Firebase
  async function guardarPuntuacion(nombre, puntuacion) {
    try {
      await database.ref('puntuaciones').push({
        nombre: nombre,
        puntuacion: puntuacion,
        fecha: firebase.database.ServerValue.TIMESTAMP
      });
      console.log("Puntuaci√≥n guardada");
      obtenerRanking();
    } catch (error) {
      console.error("Error al guardar:", error);
    }
  }

  function obtenerRanking() {
    database.ref('puntuaciones')
      .orderByChild('puntuacion')
      .limitToLast(10)
      .once('value', (snapshot) => {
        const ranking = [];
        snapshot.forEach((child) => {
          ranking.push(child.val());
        });
        ranking.sort((a, b) => b.puntuacion - a.puntuacion);
        mostrarRanking(ranking);
      });
  }

  function mostrarRanking(datos) {
    const rankingList = document.getElementById('ranking-list');
    if (!rankingList) return;
    
    rankingList.innerHTML = '';
    datos.slice(0, 10).forEach((item, index) => {
      const li = document.createElement('li');
      li.innerHTML = `<strong>${index + 1}.</strong> ${item.nombre}: <span style="color: #e8590c;">${item.puntuacion}/10</span>`;
      rankingList.appendChild(li);
    });
    
    const rankingContainer = document.getElementById('ranking-container');
    if (rankingContainer) {
      rankingContainer.style.display = 'block';
    }
  }

  // Mostrar ranking al cargar la p√°gina
  window.addEventListener('load', obtenerRanking);
})();
</script>
</body>
</html>